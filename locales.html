<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Locales</title>
    <link rel="stylesheet" href="styles/styles.css">
    
</head>
<body>
  <div class="month-selector">
    <label for="mes">Selecciona el mes:</label>
    <select id="mes" name="mes">
        <option value="enero">Enero</option>
        <option value="febrero">Febrero</option>
        <option value="marzo">Marzo</option>
        <option value="abril">Abril</option>
        <option value="mayo">Mayo</option>
        <option value="junio">Junio</option>
        <option value="julio">Julio</option>
        <option value="agosto">Agosto</option>
        <option value="septiembre">Septiembre</option>
        <option value="octubre">Octubre</option>
        <option value="noviembre">Noviembre</option>
        <option value="diciembre">Diciembre</option>
    </select>
</div>
    <div id="header" class="centrado">
        <span id="estado-usuario"></span>
        <button id="boton-mapa" onclick="irAlMapa()">Ir al Mapa</button>
    </div>

    <!-- Formulario para agregar locales -->
    <div id="agregar-local">
        <input type="text" id="nombre-local" placeholder="Nombre del Local o Persona" required>
        <input type="text" id="direccion" placeholder="Dirección" required>
        <input type="text" id="numero-finca" placeholder="Número de Finca" required>
        <select id="factura" required onchange="mostrarOpcionesFactura(this)">
            <option value="" disabled selected>Seleccionar Factura</option>
            <option value="A">Factura A</option>
            <option value="B">Factura B</option>
            <option value="otra">Otra</option>
        </select>
        <input type="number" id="monto-factura-a" placeholder="Monto Factura A" style="display:none;" disabled>
        <div class="tasa-opciones" id="tasa-opcion" style="display:none;">
            <label for="tasa-check">Tasa:</label>
            <input type="checkbox" id="tasa-check" checked disabled>
            <input type="number" id="tasa" placeholder="Monto de la Tasa" disabled>
        </div>
        <select id="mes" required>
            <option value="" disabled selected>Seleccionar Mes</option>
            <option value="enero">Enero</option>
            <option value="febrero">Febrero</option>
            <option value="marzo">Marzo</option>
            <option value="abril">Abril</option>
            <option value="mayo">Mayo</option>
            <option value="junio">Junio</option>
            <option value="julio">Julio</option>
            <option value="agosto">Agosto</option>
            <option value="septiembre">Septiembre</option>
            <option value="octubre">Octubre</option>
            <option value="noviembre">Noviembre</option>
            <option value="diciembre">Diciembre</option>
        </select>
        <button onclick="agregarLocal()">Agregar Local</button>
    </div>

    <!-- Lista de locales -->
    <div id="lista-locales"></div>

    <!-- Lista de locales realizados -->
    <div id="lista-locales-realizados"></div>

    <!-- Contadores -->
    <div id="contadores">
        <span id="total-locales"></span>
        <span id="total-dinero"></span>
        <span id="total-tasas"></span>
        <span id="locales-desinfectados"></span>
    </div>

    <script type="module" src="scripts/scripts.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyA_W6iFuTLoWVf0VExW7QTy9VJlXnMUOS0",
          authDomain: "malgariuz.firebaseapp.com",
          projectId: "malgariuz",
          storageBucket: "malgariuz.appspot.com",
          messagingSenderId: "18994913717",
          appId: "1:18994913717:web:be2e0b0e5d63211d6bb9fc",
          measurementId: "G-56D4TMG32S"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
      </script>
      <!-- Firebase App (la base) -->
<script src="https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.8.1/firebase-firestore.js"></script>
<script>
// Inicializa Firebase


// Funciones para Firestore
async function agregarLocalFirestore(local) {
  try {
    const docRef = await addDoc(collection(db, "locales"), local);
    console.log("Documento agregado con ID: ", docRef.id);
  } catch (e) {
    console.error("Error añadiendo el documento: ", e);
  }
}

async function obtenerLocalesFirestore() {
  try {
    const querySnapshot = await getDocs(collection(db, "locales"));
    const locales = [];
    querySnapshot.forEach((doc) => {
      locales.push({ id: doc.id, ...doc.data() });
    });
    return locales;
  } catch (e) {
    console.error("Error obteniendo documentos: ", e);
  }
}

async function actualizarLocalFirestore(id, updatedLocal) {
  try {
    const localRef = doc(db, "locales", id);
    await updateDoc(localRef, updatedLocal);
    console.log("Documento actualizado con ID: ", id);
  } catch (e) {
    console.error("Error actualizando el documento: ", e);
  }
}

async function eliminarLocalFirestore(id) {
  try {
    await deleteDoc(doc(db, "locales", id));
    console.log("Documento eliminado con ID: ", id);
  } catch (e) {
    console.error("Error eliminando el documento: ", e);
  }
}

// Ejemplo de uso
document.addEventListener('DOMContentLoaded', async () => {
  // Agregar un local (sólo para prueba, asegúrate de tener los datos correctos)
  await agregarLocalFirestore({
    nombre: "local 1",
    direccion: "dirección ejemplo",
    costo: 2500,
    factura: "A",
    estado: "no-listo",
    numeroFinca: "1234"
  });

  // Obtener y mostrar locales
  const locales = await obtenerLocalesFirestore();
  console.log("Locales obtenidos: ", locales);

  // Actualizar un local (reemplaza 'id_del_local' con el ID real del documento)
  await actualizarLocalFirestore('id_del_local', {
    estado: "realizado"
  });

  // Eliminar un local (reemplaza 'id_del_local' con el ID real del documento)
  await eliminarLocalFirestore('id_del_local');
});
</script>
<hr id="linea-separadora" style="display: none;">

</body>
</html>
